# Characterization of polarimetric properties in various brain tumor types using wide-field imaging Mueller polarimetry

by Éléa Gros

The manuscript linked to the present repository, entitled "Characterization of polarimetric properties in various brain tumor types using wide-field imaging Mueller polarimetry", is currently published in IEEE Transactions on Medical Imaging [https://doi.org/10.1109/TMI.2024.3413288](10.1109/TMI.2024.3413288). The present repository contains the code used to generate the results presented in the manuscript.

The study aimed to quantify the polarimetric parameters of neoplastic brain tissue. 

## Abstract

Neuro-oncological surgery is the primary treatment for brain cancer, yet it faces challenges in brain tumors such as gliomas due to their aggressive invasiveness and the concurrent need to preserve neurological function.
Hence, achieving a radical resection is often unfeasible, emphasizing the need for precise tumor boundary delineation to prevent neurological deficits and improve prognosis.
Imaging Mueller polarimetry has emerged as a promising modality for tumor delineation, demonstrating effectiveness in various organ tissues.
Towards the use of Mueller polarimetry in the field of neurosurgery we characterized the polarimetric properties of human brain tumors.
We analyzed the results of 45 polarimetric measurements, obtained from 27 fresh brain tumor specimens in a total of 16 patients, including different tumor types with a strong focus on gliomas.
Our study combines the implementation of a wide-field imaging Mueller polarimetric system and a novel neuropathology protocol to correlate polarimetric and histological data, serving as a reliable ground truth for tissue identification.
An image processing pipeline facilitated the alignment of histological and polarimetric images, thus, enabling histology mask overlay on polarimetric images.
We observed the relevant variations in depolarization values for grey and white matter regions, while differences in the values of linear retardance were observed only within white matter regions of brain tumor tissue.
Notably, we identified pronounced optical axis azimuth randomization within tumor regions, promising advances in brain tumor delineation via machine learning.
This study lays the foundation for machine learning-based brain tumor segmentation algorithms using polarimetric data, facilitating intraoperative diagnosis and decision making.


## Software implementation

This GitHub repository documents all the source code used to generate the results and figures in the paper.

The [Jupyter notebooks](http://jupyter.org/) used to generate the results are located in the `notebooks` folder. The data used in this study should be copied downloaded from [this repository](https://osf.io/rsxgp/?view\_only=c1cc83138a494606820e86c173d8d6f2), and placed in the `data` folder. The `calib` subfolder, found in the `data_to_share.zip` archive should be placed at the root of the repository. Results generated by the code are saved in `results`. Source code used to process the data are loacted in the `src` folder.


## Getting the code

You will in a first time need to create a environnement for imageJ computing in python, following the instructions [here](https://py.imagej.net/en/latest/Install.html):

Install [miniforge3](https://github.com/conda-forge/miniforge#miniforge3)

Install PyImageJ into a new environment

    mamba create -n pyimagej pyimagej openjdk=11

Activate the new environment

    mamba activate pyimagej

You can now download a copy of all the files in this repository by cloning the
[git](https://git-scm.com/) repository:

    git clone https://github.com/RomGr/HistoPolAligner.git

open a terminal and go to the location of the downloaded folder:

    pip install -e .

After installing the package, you will need to download [Fiji](https://imagej.net/software/fiji/downloads), and copy-paste the files in the `Fiji.app` folder located at the root of the repository.

You will also neeed to install `matlab.engine` package ([instructions here](https://ch.mathworks.com/help/matlab/matlab_external/install-the-matlab-engine-for-python.html)), with MATLAB version earlier being R2022B or R2023A to avoid troubles with the `matlab.engine` package.
    
    cd "matlabroot\extern\engines\python"
    python -m pip install .

Finally, install the tool to process Mueller Matrices 

    pip install git+https://github.com/RomGr/processingMM.git

## Align Polarimetry and Histology
The juypter notebooks 1. `AlignHistologyPolarimetrySingleMeasurement.ipynb` and 2. `AlignHistologyPolarimetry.ipynb` are the notebooks used to align:
1. The polarimetry images with the histology images for one sample
2. The polarimetry images with the histology images for all the samples


## Azimuth standard deviation
The juypter notebook `CreateAzimuthStd.ipynb` allows to visualize the local level of noise of the azimuth of the optical axis. The output for this notebook can be found in the different measurements folders, in the `histology` subfolder.

## Get samples information
The juypter notebook `GetSamplesInfo.ipynb` allows to get the samples information from the excel file `samples_paper.xlsx`.

## Verify Alignment Procedure
The juypter notebook `VerifyAlignmentProcedure.ipynb` is a notebook to verify the alignment procedure and to quantify the error between the histology and polarimetry images. The output for this notebook can be found in the different measurements folders, in the `histology` subfolder.

## Quantifiy Parameters Healthy Vs Tumor
The last jupyter notebook `QuantifiyParametersHealthyVsTumor.ipynb` allows to quantify the polarimetric parameters in healthy and tumor regions. The output for this notebook can be found in `results` folder.

## Data
Five subfolders can be found in the `data` folder:
1. `HealthyHuman`: the measurements of healthy human section
2. `HistologyResults`: the histology images of the samples
3. `TumorMeasurements`: the measurements of neoplastic human section

## License
All source code is made available under a BSD license. See `LICENSE` for the full license text.

## Citation
If you use this code or data, please cite the associated manuscript:
```
É. Gros et al., "Characterization of Polarimetric Properties in Various Brain Tumor Types Using Wide-Field Imaging Mueller Polarimetry," in IEEE Transactions on Medical Imaging, vol. 43, no. 12, pp. 4120-4132, Dec. 2024, doi: 10.1109/TMI.2024.3413288.
```

## Acknowledgements
Special thanks to Stefano Moriconi for the development of the pipeline for processing the Mueller polarimetry images.


